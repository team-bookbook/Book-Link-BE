<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket 1:1 Chat Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2/dist/stomp.min.js"></script>
</head>
<body>
<h2>1:1 ì±„íŒ… WebSocket í…ŒìŠ¤íŠ¸</h2>

<div>
    <label>ì±„íŒ…ë°© ID:</label>
    <input type="text" id="chatId" value="550e8400-e29b-41d4-a716-446655440000" size="40">
</div>
<div>
    <label>ë³´ë‚¸ ì‚¬ëžŒ ID:</label>
    <input type="text" id="senderId" value="3fa85f64-5717-4562-b3fc-2c963f66afa6" size="40">
</div>
<div>
    <label>ë©”ì‹œì§€:</label>
    <input type="text" id="messageText" size="40">
    <button onclick="sendMessage()">ì „ì†¡</button>
</div>

<hr>
<button onclick="connect()">ì—°ê²°í•˜ê¸°</button>
<button onclick="disconnect()">ì—°ê²° í•´ì œ</button>

<h3>ë©”ì‹œì§€ ë¡œê·¸</h3>
<ul id="messages"></ul>

<script>
    let stompClient = null;

    function connect() {
        const socket = new SockJS("/ws/chat");
        stompClient = Stomp.over(socket);

        stompClient.connect({
            "Authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0MUBleGFtcGxlLmNvbSIsInJvbGUiOiJDVVNUT01FUiIsImlhdCI6MTc1OTE1NTEzOCwiZXhwIjoxNzU5MTU4NzM4fQ.tdMnlp4kGv0WuDZ9_AFiAywasofIVE-29fH_PqBEQ-8"
        }, () => {
            const chatId = document.getElementById("chatId").value;
            log("Connected. Subscribing to /sub/chat/" + chatId);

            stompClient.subscribe("/sub/chat/" + chatId, (message) => {
                const body = JSON.parse(message.body);
                log("ðŸ“© " + body.senderId + ": " + body.text + " (" + body.sentAt + ")");
            });
        });
    }

    function disconnect() {
        if (stompClient !== null) {
            stompClient.disconnect();
            log("Disconnected");
        }
    }

    function sendMessage() {
        const chatId = document.getElementById("chatId").value;
        const senderId = document.getElementById("senderId").value;
        const text = document.getElementById("messageText").value;

        stompClient.send("/pub/chat.sendMessage/" + chatId, {}, JSON.stringify({
            chatId: chatId,
            senderId: senderId,
            text: text,
            attachments: []
        }));
        log("ðŸ“¤ Sent: " + text);
    }

    function log(message) {
        const li = document.createElement("li");
        li.innerText = message;
        document.getElementById("messages").appendChild(li);
    }
</script>
</body>
</html>
